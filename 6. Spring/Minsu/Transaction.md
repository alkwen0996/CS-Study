## Transaction

---

### λ°μ΄ν„°λ² μ΄μ¤ νΈλμ­μ… ( Transaction )

λ°μ΄ν„°λ² μ΄μ¤μ—μ„ νΈλμ­μ…μ΄λ€ λ°μ΄ν„°λ² μ΄μ¤μ μƒνƒλ¥Ό λ³€ν™”μ‹ν‚¤κΈ° μ„ν•΄ μν–‰ν•λ” μ‘μ—… λ‹¨μ„λ΅ ν•λ‚μ μ‘μ—…μ„ μ„ν•΄ λ” μ΄μƒ λ¶„ν• λ  μ μ—†λ” ν•κΊΌλ²μ— μν–‰λμ–΄μ•Ό ν•  μ‘μ—…λ“¤μ μ§‘ν•©μ„ μλ―Έν•λ‹¤. νΈλμ­μ…μ€ μ—¬λ¬ κ°μ ν΄λΌμ΄μ–ΈνΈκ°€ λ™μ‹μ— λ°μ΄ν„°μ— μ•΅μ„Έμ¤ ν•κ±°λ‚ ν”„λ΅κ·Έλ¨μ΄ λ°μ΄ν„°λ¥Ό μμ •ν•λ” κ³Όμ •μ—μ„ λ°μ΄ν„° λ¶€μ •ν•©μ„ λ°©μ§€ν•κ³ μ ν•λ” λ©μ μΌλ΅ μ‚¬μ©λλ©° λ°μ΄ν„°λ² μ΄μ¤μ—μ„ μ΄ νΈλμ­μ…μ„ μ΅°μ‘ν•¨μΌλ΅μ¨ μ‚¬μ©μκ°€ λ°μ΄ν„°λ² μ΄μ¤μ— λ€ν• μ™„μ „μ„±μ„ μ‹ λΆ°ν•  μ μλ„λ΅ ν•λ‹¤.

<br>

> **[ λ°μ΄ν„°λ² μ΄μ¤ νΈλμ­μ… κ΄€λ¦¬ ]** <br>
> λ°μ΄ν„°λ² μ΄μ¤λ” νΈλμ­μ… κ΄€λ¦¬λ¥Ό μ„ν• μ„¤μ •μ„ κ°€μ§€κ³  μλ‹¤. λ°μ΄ν„°λ² μ΄μ¤λ” λ…λ Ήμ„ λλ‚Όλ•κΉμ§€ μν–‰ λ‚΄μ—­μ„ λ΅κ·Έμ— μ €μ¥ν•λ‹¤. λ°μ΄ν„°λ² μ΄μ¤μ— λ°μλ λ‚΄μ©μ„ μ¬λ°μν•κΈ° μ„ν• `read log`μ™€ μν–‰μ„ μ‹¤ν¨μ μ΄μ „μ μƒνƒλ΅ λλλ¦¬λ” `undo log`λ¥Ό μ΄μ©ν•΄ νΈλμ­μ…μ„ μ§€μ›ν•λ‹¤.

<br>

### νΈλμ­μ…μ νΉμ§•

- μ›μμ„± - νΈλμ­μ…μ΄ λ¨λ‘ DBμ— λ°μλκ±°λ‚ νΉμ€ μ „ν€ λ°μλμ§€ μ•μ•„μ•Ό ν•λ‹¤.
- μΌκ΄€μ„± - νΈλμ­μ…μ μ‘μ—…μ²λ¦¬ κ²°κ³Όλ” ν•­μƒ μΌκ΄€μ„±μ΄ μμ–΄μ•Ό ν•λ‹¤.
- λ…λ¦½μ„± - λ‘ μ΄μƒμ νΈλμ­μ…μ΄ λ™μ‹μ— μ‹¤ν–‰λκ³  μμ„ λ• μ–΄λ– ν• νΈλμ­μ…λ„ λ‹¤λ¥Έ νΈλμ­μ…μ μ‘μ—…μ— μν–¥μ„ λ―ΈμΉ  μ μ—†λ‹¤.
- μ§€μ†μ„± - νΈλμ­μ…μ΄ μ„±κ³µμ μΌλ΅ μ™„λ£λμ—μΌλ©΄ κ²°κ³Όλ” μκµ¬μ μΌλ΅ λ°μλμ–΄μ•Ό ν•λ‹¤.

<br>

### Spring κ³Ό Transaction

λ°μ΄ν„°λ² μ΄μ¤μ—μ„λ” κ°κ°μ λ…λ Ήμ„ ν•λ‚μ νΈλμ­μ…μΌλ΅ λ³΄κ³  λ³΄μ¥ν•΄μ£ΌκΈ° λ•λ¬Έμ— μ—¬λ¬ λ…λ Ήμ„ ν•λ‚μ νΈλμ­μ…μΌλ΅ λ¬¶κ³ μ‹¶μ€κ²½μ° κ°λ°μκ°€ μ§μ ‘ νΈλμ­μ… κ²½κ³„μ„¤μ •μ„ ν†µν•΄ μ—¬λ¬ λ…λ Ήμ„ ν•λ‚μ νΈλμ­μ…μΌλ΅ λ…μ‹ν•λ” μΌμ΄ ν•„μ”ν•λ‹¤. ν•μ§€λ§, λΉ„μ¦λ‹μ¤ λ΅μ§κ³Ό νΈλμ­μ… μ²λ¦¬ λ΅μ§μ΄ λ™μ‹μ— μ΅΄μ¬ν•λ‹¤λ©΄ μ½”λ“μ μ¤‘λ³µμ΄ μƒκΈΈ μ μκ³  λΉ„μ¦λ‹μ¤ λ΅μ§ μ‘μ„±μ—λ§ μ§‘μ¤‘ν•κΈ° μ–΄λ µλ‹¤ λΉ„μ¦λ‹μ¤ λ΅μ§μ— μ§‘μ¤‘ν•κΈ° μ„ν•΄ μ¤ν”„λ§μ€ ν¬κ² 2κ°€μ§€ νΈλμ­μ… μ μ© κΈ°μ μ„ μ§€μ›ν•΄μ¤€λ‹¤.

<br>

### TransactionTemplate

λ°μ΄ν„° μ ‘κ·Ό κΈ°μ μ—λ” Jdbc, JPA λ“± μ—¬λ¬κ°€μ§€κ°€ μ΅΄μ¬ν•λ‹¤. κΈ°μ μ΄ λ°”λ€λ©΄ νΈλμ­μ…μ„ μ‚¬μ©ν•λ” λ°©λ²•λ„ λ‹¬λΌμ§„λ‹¤. μ΄λ¬ν• μƒν™©μ„ κ³ λ ¤ν•μ—¬ μ¤ν”„λ§μ€ νΈλμ­μ…μ— λ€ν• μ¶”μƒν™”λ¥Ό `PlatformTransactionManager` ν†µν•΄ μ§€μ›ν•λ‹¤.

`PlatformTransactionManager`λ” `DataSource`μ— λ§κ² νΈλμ­μ…μ„ κ΄€λ¦¬ν•  μ μκ² κΈ°λ¥μ„ μ κ³µν•κ³  μλ‹¤. `PlatformTransactionManager` λ” `getTransaction`, `rollback`, `commit` μΌλ΅ κµ¬μ„±λμ–΄ μλ‹¤.

`getTransaction` λ©”μ„λ“λ¥Ό ν†µν•΄μ„ νλΌλ―Έν„°λ΅ μ „λ‹¬λλ” `TransactionDefinition`μ— λ”°λΌ νΈλμ­μ…μ„ μ‹μ‘ν•λ‹¤. νΈλμ­μ…μ„ λ¬Έμ μ—†μ΄ μ™„λ£ν•λ©΄ `commit` μ„ λ¬Έμ κ°€ λ°μƒν•λ©΄ `rollback` μ„ νΈμ¶ν•λ‹¤. `getTransaction` νΈλμ­μ…λ¶€ν„° `commit` λλ” `rollback` μ„ ν•λ” λ¶€λ¶„κΉμ§€ νΈλμ­μ… κ²½κ³„μ„¤μ •μ΄λ‹¤.

μ¤ν”„λ§μ€ `PlatformTransactionManager` μ κµ¬ν„μ²΄λ΅ `JDBC`μ— μ‚¬μ©λλ” `DataSourceTransactionManager` κ·Έλ¦¬κ³  `JPA`μ— μ‚¬μ©λλ” `JpaTransactionManager` λ¥Ό μ κ³µν•λ‹¤. μ΄ λ‘ κµ¬ν„μ²΄λ” ν•λ‚μ λ°μ΄ν„°λ² μ΄μ¤λ¥Ό μ‚¬μ©ν•κ±°λ‚ κ°κ°μ λ°μ΄ν„°λ¥Ό λ…λ¦½μ μΌλ΅ μ‚¬μ©ν•λ” λ΅μ»¬ νΈλμ­μ…μ κ²½μ° μ‚¬μ©ν•  μ μλ‹¤.

λ§μ•½, ν•λ‚ μ΄μƒμ λ°μ΄ν„°λ² μ΄μ¤κ°€ μ‚¬μ©λλ” κ²½μ°λΌλ©΄ κΈ€λ΅λ² νΈλμ­μ…μ— ν•΄λ‹Ήλλ” `JtaTransactionManager`λ¥Ό μ‚¬μ©ν•  μ μλ‹¤. μ—¬λ¬ κ°μ λ°μ΄ν„°λ² μ΄μ¤μ— λ€ν• μ‘μ—…μ„ ν•λ‚μ νΈλμ­μ…μΌλ΅ λ¬¶μ„ μ μκ³  λ‹¤λ¥Έ μ„λ²„μ— λ¶„μ‚°λ μ‘μ—…λ„ λ¬¶μ„ μ μλ‹¤.

μ΄λ ‡κ² μ§μ ‘μ μΌλ΅ μ½”λ“μ— κµ¬ν„ν•λ” νΈλμ­μ… λ°©μ‹ μ™Έμ—λ„ μ¤ν”„λ§μ€ `AOP`λ¥Ό μ΄μ©ν• μ„ μ–Έμ  νΈλμ­μ…μ„ μ κ³µν•λ‹¤. μ„ μ–Έμ  νΈλμ­μ…μ€ `tx λ„¤μ„μ¤νμ΄μ¤`λ¥Ό μ΄μ©ν•λ” λ°©λ²•κ³Ό μ–΄λ…Έν…μ΄μ…μ„ κΈ°λ°μΌλ΅ μ„¤μ •ν•λ” λ°©λ²•μ΄ μλ‹¤.

<br>

### μ„ μ–Έμ  νΈλμ­μ…

`tx λ„¤μ„μ¤νμ΄μ¤λ¥Ό μ΄μ©ν•λ” λ°©λ²•`μ€ `Bean μ„¤μ • νμΌ`μ—μ„ νΈλμ­μ… λ§¤λ‹μ €λ¥Ό λ“±λ΅ν•κ³  μ†μ„±κ³Ό λ€μƒμ„ μ •μν•΄ νΈλμ­μ…μ„ μ μ©ν•κ² λ‹¤κ³  λ…μ‹ν•λ” λ°©λ²•μ΄λ‹¤. μ΄λ ‡κ² μ μ©ν•λ©΄ μ½”λ“μ—λ” μν–¥μ„ μ£Όμ§€ μ•κ³  μΌκ΄„μ μΌλ΅ νΈλμ­μ…μ„ μ μ©ν•κ³  λ³€κ²½ν•  μ μλ‹¤.

`μ–΄λ…Έν…μ΄μ…μ„ κΈ°λ°μΌλ΅ νΈλμ­μ…μ„ μ„¤μ •ν•λ” λ°©λ²•`μ€ νΈλμ­μ… μ–΄λ…Έν…μ΄μ…μ„ λ©”μ„λ“, ν΄λμ¤, μΈν„°νμ΄μ¤μ— μ μ©ν•μ—¬ μ‚¬μ©ν•  μ μλ‹¤. ν΄λμ¤ μƒλ‹¨μ— μ΅΄μ¬ν•λ” μ–΄λ…Έν…μ΄μ…μ— λ€ν•΄μ„λ” ν•΄λ‹Ή ν΄λμ¤μ— μ΅΄μ¬ν•λ” λ¨λ“ λ©”μ„λ“μ— μ–΄λ…Έν…μ΄μ…μ΄ μ μ©λλ‹¤.

μ¤‘μ²©λμ–΄ μ΅΄μ¬ν•λ” κ²½μ°μ—λ” ν΄λμ¤ λ©”μ„λ“ β†’ ν΄λμ¤ β†’ μΈν„°νμ΄μ¤ λ©”μ„λ“ β†’ μΈν„°νμ΄μ¤ μμΌλ΅ μ°μ„ μμ„λ¥Ό κ°€μ§€κ³  μ μ©λλ‹¤. μ–΄λ…Έν…μ΄μ…μ΄ μ μ©λ λ©”μ„λ“λ” λ©”μ„λ“ μ‹μ‘λ¶€ν„° νΈλμ­μ…μ΄ μ‹μ‘λκ³  λ©”μ„λ¥Ό μ„±κ³µμ μΌλ΅ μ™„λ£ν•λ©΄ νΈλμ­μ… μ»¤λ°‹ λ„μ¤‘μ— λ¬Έμ κ°€ λ°μƒν•λ©΄ λ΅¤λ°±κ³Όμ •μ΄ μ§„ν–‰λλ‹¤.

<br>

### [ Reference ]

[[10λ¶„ ν…μ½”ν†΅] π¤ μƒλ¦¬μ α„α…³α„…α…Άα†«α„α…Άα†¨α„‰α…§α†«](https://www.youtube.com/watch?v=aX9c7z9l_u8)
